<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Main Dashboard</title>
  <link rel="stylesheet" href="./styles.css" />

<meta name="theme-color" content="#111111">

<!-- iOS-specific -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Money Planner">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">

</head>
<body>
  <header class="topbar">
    <nav class="nav">
      <a class="active" href="./index.html">Dashboard</a>
      <a href="./savings.html">Savings</a>
      <a href="./planner.html">Planner</a>
    </nav>
  </header>

  <main class="container grid">
    <section class="card">
      <h1>Dashboard</h1>
      <div class="kpi">
        <div class="kpi-label">Current Balance</div>
        <div id="dashBalance" class="kpi-value">Â£0.00</div>
      </div>
      <div class="row-between">
        <a class="btn secondary" href="./savings.html">Open savings</a>
        <a class="btn secondary" href="./planner.html">Open planner</a>
      </div>
    </section>

    <section class="card">
      <h2>To do today</h2>
      <div id="dashToday" class="list"></div>
    </section>

    <section class="card">
      <h2>Recent transactions</h2>
      <div id="dashTx" class="list"></div>
    </section>
  </main>

  <script src="./app.js"></script>
  <script>
    const dashBalance = document.getElementById("dashBalance");
    const dashToday = document.getElementById("dashToday");
    const dashTx = document.getElementById("dashTx");

    function isSameDay(a, b) {
      return a.getFullYear() === b.getFullYear() &&
             a.getMonth() === b.getMonth() &&
             a.getDate() === b.getDate();
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function renderDashboard() {
      const txs = getTransactions().sort((a,b) => new Date(b.date) - new Date(a.date));
      dashBalance.textContent = formatCurrency(calculateBalance(txs));

      dashTx.innerHTML = txs.slice(0, 5).map(tx => `
        <div class="row">
          <div>
            <div class="row-title">${escapeHtml(tx.category)}</div>
            <div class="row-sub">${new Date(tx.date).toLocaleString()}</div>
          </div>
          <div class="row-amount ${tx.kind === "saving" ? "pos" : "neg"}">
            ${tx.kind === "saving" ? "+" : "-"}${formatCurrency(Number(tx.amount))}
          </div>
        </div>
      `).join("") || `<div class="muted">No transactions yet.</div>`;

      const tasks = getTasks().sort((a,b) => new Date(a.start) - new Date(b.start));
      const today = new Date();
      const todays = tasks.filter(t => isSameDay(new Date(t.start), today));

      dashToday.innerHTML = todays.map(t => `
        <div class="row">
          <div>
            <div class="row-title ${t.status === "done" ? "done" : ""}">${escapeHtml(t.title)}</div>
            <div class="row-sub">${new Date(t.start).toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"})}</div>
          </div>
          <div class="pill ${t.status === "done" ? "pill-done" : "pill-open"}">
            ${t.status === "done" ? "Done" : "Open"}
          </div>
        </div>
      `).join("") || `<div class="muted">No tasks today.</div>`;
    }

    renderDashboard();
  </script>
</body>
</html>



